#!/bin/bash

usage() {
    echo "Usage: $0 <PORT_NUMBER>"
    echo "  <PORT_NUMBER>: The port number (e.g., 8080, 3000) you want to free up."
    echo "Example: $0 8080"
    exit 1
}

if [ -z "$1" ]; then
    echo "Error: No port number provided."
    usage
fi

PORT="$1"

echo "Searching for processes listening on port $PORT..."

# Use lsof to find the PID(s) listening on the specified port.
# -i :<PORT> specifies the internet address (port number).
# -t outputs only the process IDs.
PIDS=$(lsof -i :"$PORT" -t)

# Check if any PIDs were found
if [ -z "$PIDS" ]; then
    echo "No process found listening on port $PORT."
else
    echo "Found process(es) with PID(s): $PIDS listening on port $PORT."
    read -p "Are you sure you want to kill these processes? (y/N): " confirm

    if [[ "$confirm" =~ ^[Yy]$ ]]; then
        echo "Attempting to kill process(es)..."
        # Kill the process(es) forcefully using kill -9
        # The -9 signal ensures the process is terminated immediately.
        kill -9 $PIDS

        # Check the exit status of the kill command
        if [ $? -eq 0 ]; then
            echo "Process(es) on port $PORT killed successfully."
        else
            echo "Failed to kill process(es) on port $PORT."
            echo "This might be due to insufficient permissions. Try running with 'sudo':"
            echo "  sudo $0 $PORT"
        fi
    else
        echo "Operation cancelled by user."
    fi
fi
